<!-- click to view https://raw.githack.com/hongsonitptit/vnfunds_data/main/charts/vn_funds.html -->
<link rel="stylesheet" type="text/css" href="https://code.highcharts.com/css/stocktools/gui.css">
<link rel="stylesheet" type="text/css" href="https://code.highcharts.com/css/annotations/popup.css">

<script src="https://code.highcharts.com/stock/highstock.js"></script>
<!-- provide fullscreen option -->
<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
<!-- provide getJSON -->
<script src="https://code.highcharts.com/modules/data.js"></script>
<!-- display label in line -->
<!-- <script src="https://code.highcharts.com/modules/series-label.js"></script> -->
<script src="https://code.highcharts.com/stock/indicators/indicators-all.js"></script>
<script src="https://code.highcharts.com/stock/modules/drag-panes.js"></script>
<script src="https://code.highcharts.com/modules/annotations-advanced.js"></script>
<script src="https://code.highcharts.com/modules/price-indicator.js"></script>
<script src="https://code.highcharts.com/modules/stock-tools.js"></script>
<script src="https://code.highcharts.com/modules/full-screen.js"></script>
<div id="container1"></div>
<div id="container2"></div>

<style>
    #container {
        max-width: 800px;
        height: 400px;
        margin: 1em auto;
    }
</style>

<script>
    var seriesOptions = [],
        seriesCounter = 0,
        global_symbols = [];

    /**
     * Create the chart when all data is loaded
     * @returns {undefined}
     */
    function createChart() {

        Highcharts.stockChart('container1', {

            // show legend
            legend: {
                enabled: true
            },

            // show grid line in y axis
            yAxis: {
                labels: {
                    formatter: function() {
                        return (this.value > 0 ? ' + ' : '') + this.value + '%';
                    }
                }
            },

            plotOptions: {
                series: {
                    compare: 'percent'
                }
            },

            tooltip: {
                pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',
                valueDecimals: 0
            },

            series: seriesOptions
        });

        Highcharts.stockChart('container2', {

            // show legend
            legend: {
                enabled: true
            },

            // show grid line in y axis
            yAxis: {
                labels: {
                    formatter: function() {
                        return (this.value > 0 ? ' + ' : '') + this.value + '%';
                    }
                }
            },

            plotOptions: {
                series: {
                    compare: 'percent'
                }
            },

            tooltip: {
                pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',
                valueDecimals: 0
            },

            series: seriesOptions
        });
    }

    function success(data) {
        console.log(global_symbols);
        let url = this.url;
        let file_name = url.split('/').pop();
        let symbol = file_name.split('.')[0];
        var i = global_symbols.indexOf(symbol);
        seriesOptions[i] = {
            name: symbol,
            data: data
        };

        // As we're loading the data asynchronously, we don't know what order it
        // will arrive. So we keep a counter and create the chart when all the data is loaded.
        seriesCounter += 1;

        if (seriesCounter === global_symbols.length) {
            createChart();
        }
    }

    function get_symbols(data) {
        global_symbols = data;
        console.log(global_symbols);
        for (i in data) {
            symbol = data[i];
            url = "https://raw.githubusercontent.com/hongsonitptit/vnfunds_data/main/data/" + symbol + ".json";
            console.log(url);
            Highcharts.getJSON(url, success);
        }
    }

    Highcharts.getJSON(
        'https://raw.githubusercontent.com/hongsonitptit/vnfunds_data/main/data/symbols.json',
        get_symbols
    );
</script>